---
layout: post
title:  "B站录播姬 v1.3.1"
date:   2021-05-14 00:00:00
author: Genteure
---

## 录播姬 1.3 发布

录播姬的第一个 1.3 正式版的版本号是 1.3.1

**更新说明**：1.3.1 中有一个不影响录制的bug，会导致录出的文件在一部分播放器里刚刚打开时出现卡顿、CPU占用高等现象。已经发布 1.3.2 修复了这个问题。  
**梅开二度**：1.3.3 修复了一个导致部分设置开关不能正确保存到配置文件的bug。

本次更新的改动非常大，从规划到完成共耗时近10个月，除了界面以外几乎重写了所有代码，主要修改可以分为两部分：软件功能（监控、自动录制）和直播数据处理。  
除此以外录播姬命令行版也在 1.3 开始与桌面版同步发布，可在 Windows Mac Linux 使用。命令行版暂无交互界面和接口，只能读取配置文件运行，不建议一般用户使用。

本站的使用文档已更新，关于目前录播姬的各种功能、用法、说明，见本站使用文档。

### 数据处理

录播姬 1.3 完全重写了直播数据处理代码，通过总结分析以前用户反馈的各种有问题的录播文件实现了一套B站录播文件修复系统，做到了边录边修，并可一键全自动修复绝大部分B站直播的录播文件存在的问题。

录播姬 1.3 有两个录制模式：标准模式 和 原始数据模式，默认为标准模式。在标准模式下录制时，直播数据会经过修复系统处理，边录边修。  
更多关于录制模式的介绍，请看文档页 [录制模式](/docs/basic/record_mode/)

在新的直播数据处理系统的基础上实现了统计更多的数据，这些数据会显示在房间卡片的录制状态里，便于判断当前录制的状态。

录播姬之前的版本会在录播文件关闭之前向文件内写入总时长信息。录播姬 1.3 使用新的文件写入策略，在每一小段直播数据写入后都会更新视频总时长信息，边录边播体验更好。

录播姬 1.3 标准模式下录制的视频文件中会包含直播间的信息，视频标题为直播间标题，视频作者为主播名。

录播姬 1.3 添加了新的工具箱模式，打开软件后在选择工作目录的界面可以点击“工具箱”按钮进入工具箱模式。工具箱模式下不启动录制逻辑，无需选择工作目录。  
在左侧的导航条中添加了工具箱菜单，目前工具箱中只有一个“录播修复”，可以对录播文件进行分析和修复，如有问题还可以导出分析数据以便向作者反馈。  
录播姬的后续版本会添加更多其他录播修复相关的工具。  
更多关于修复系统的介绍，请看文档页 [录播修复介绍](/docs/process/)

录播姬命令行版也提供了对应的命令，基本用法示例：

```sh
# 仅供参考，请以最新版本的 --help 输出的用法为准
./BililiveRecorder.Cli tool analyze input.flv
./BililiveRecorder.Cli tool analyze --json input.flv # 以 JSON 格式输出结果
./BililiveRecorder.Cli tool fix input.flv output.flv
./BililiveRecorder.Cli tool export input.flv output.brec.xml.gz
```

### 软件功能

录播姬 1.3 部分重写重构了监控、录制的代码，使得代码结构更清晰，也修复了一些在之前的版本里存在的 bug。

录播姬从第一个版本开始就会连接弹幕服务器，通过弹幕服务器接收实时的开播推送。这样相比轮询更稳定效果更好，直播状态更新延迟通常在 2 秒以内。但为了防止弹幕连接断开等情况导致没能收到推送，还是实现了定时主动检查更新。录播姬 1.3 把主动检查时间间隔从之前版本的 5 分钟一次改成了 10 分钟一次，并且改成了只主动检查处于监控状态的直播间。如需手动刷新状态可以点击房间卡片的三个点按钮、再点击“刷新直播间信息”按钮。

录播姬 1.3 在软件启动时，每个房间的初始化会有一点时间间隔，而不是像之前的版本一样同时获取所有直播间的数据。这样应该能尽量避免触发B站的安全机制导致被屏蔽。

录播姬 1.3 增加了屏蔽检测机制，在检测到被屏蔽后会主动暂停一切向B站API发送的请求，直到检测到屏蔽解除。希望能缓解被屏蔽、导致一直重试、导致屏蔽不会被解除的死循环。被屏蔽时会在日志里进行记录。

录播姬 1.3 重写了录制触发以及重试的逻辑。如果一个直播间开启了自动录制，并且点击了停止录制按钮，之前的版本会在下一次主动检查后重新开始录制，录播姬 1.3 改为了停止录制后本次直播都不再录制。是否放弃录制本场直播的标识会显示在房间卡片上。

### 其他修改

在之前的版本中，如果给录播姬传递了 `-w "路径"` 的参数就会跳过工作目录选择界面，在 1.3 中这个参数改为 `run "路径"`

### 命令行版

从 1.3 开始命令行版将与桌面版同步发布版本，可在本项目 GitHub 仓库的 Releases 页面下载。  
也可以从 GitHub Actions 里来源分支为 `dev-1.3` 的 Build 的 Artifacts 里下载使用，不过开发版不保证稳定可靠。

录播姬命令行版可以在 Windows, Mac, Linux (x64, arm, arm64) 上运行

录播姬命令行版的配置文件与桌面版的配置文件通用，可以在桌面版配置好相关参数后，用命令行版加载运行。

录播姬命令行版的用法见 `--help` 的输出，下面给出部分示例

```sh
# 标准模式运行
./BililiveRecorder.Cli run "/path/to/target"

# 无配置文件模式运行
./BililiveRecorder.Cli portable "/path/to/output" 1 2 3 4 5

# 分析录播文件并以 json 格式输出
./BililiveRecorder.Cli tool analyze "/path/to/recording.flv" --json
```
